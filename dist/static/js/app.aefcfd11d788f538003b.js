webpackJsonp([1],{"+oBa":function(e,t){},"0YEk":function(e,t){},"0n6d":function(e,t){},"2gkG":function(e,t){},"4OVt":function(e,t){},"A+DQ":function(e,t){},JhE6:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n("4FMX"),o=n("B2YR"),r=n.n(o),a=n("dXqY"),i={name:"Sidebar",computed:r()({},Object(a.b)(["curSidebar"])),data:function(){return{showMenu:!1}},methods:{toggleSidebar:function(e){this.$store.commit("SET_CUR_SIDEBAR",e)}},mounted:function(){var e=this;this.globalClick(function(t){e.$refs.btnOperate&&!e.$refs.btnOperate.contains(t.target)&&(e.showMenu=!1)})}},c={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-aside",{staticClass:"toolbar",staticStyle:{height:"100%",float:"left"},attrs:{width:"70px"}},[n("div",{staticClass:"bar-item",class:["Conversations"==e.curSidebar?"active":""],on:{click:function(t){e.toggleSidebar("Conversations")}}},[n("icon",{attrs:{name:"weixin"}})],1),e._v(" "),n("div",{staticClass:"bar-item",class:["Contacts"==e.curSidebar?"active":""],on:{click:function(t){e.toggleSidebar("Contacts")}}},[n("icon",{attrs:{name:"address-book-o"}})],1),e._v(" "),n("div",{ref:"btnOperate",staticClass:"bar-item bottom",on:{click:function(t){e.showMenu=!e.showMenu}}},[n("i",{staticClass:"el-icon-plus"}),e._v(" "),e.showMenu?n("div",{staticClass:"menu-block"},[n("ul",{staticClass:"menu-list"},[n("li",{staticClass:"menu-item"},[n("router-link",{staticClass:"menu",attrs:{to:{name:"SearchFriend"}}},[e._v("添加好友")])],1)])]):e._e()])])},staticRenderFns:[]};var u=n("U5Ua")(i,c,!1,function(e){n("q+OS")},"data-v-50a7a447",null).exports,l={name:"Contacts",data:function(){return{openeds:["1","2","3"]}},computed:r()({},Object(a.b)(["groupFriends","myGroups"])),filters:{toString:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString()}},created:function(){this.$store.dispatch("getMyFriends",{applyStatus:"passed"}).then(function(e){}),this.$store.dispatch("getMyGroups").then(function(e){})},methods:{handleOpen:function(e,t){console.log(e,t)},handleClose:function(e,t){console.log(e,t)}}},d={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-aside",{staticClass:"contacts-bar",staticStyle:{height:"100%"},attrs:{width:"330px"}},[n("div",[n("el-row",{staticClass:"tac"},[n("el-col",{attrs:{span:24}},[n("el-menu",{staticClass:"el-menu-vertical",attrs:{"default-active":"1",router:!0,"default-openeds":e.openeds},on:{open:e.handleOpen,close:e.handleClose}},[n("el-menu-item",{attrs:{index:"1"}},[n("span",{attrs:{slot:"title"},slot:"title"},[e._v("新消息")])]),e._v(" "),n("el-submenu",{attrs:{index:"2"}},[n("template",{slot:"title"},[n("span",[e._v("群组")])]),e._v(" "),n("el-menu-item-group",{key:"group"},[e._l(e.myGroups,function(t,s){return[n("el-menu-item",{key:t.groupId,attrs:{route:{name:"GroupInfo",params:{groupId:t.groupId}},index:e._f("toString")(t.groupId)}},[e._v(e._s(t.groupName))])]})],2)],2),e._v(" "),n("el-submenu",{attrs:{index:"3"}},[n("template",{slot:"title"},[n("span",[e._v("联系人")])]),e._v(" "),e._l(e.groupFriends,function(t,s){return[n("el-menu-item-group",{key:t.letter},[n("template",{slot:"title"},[e._v(e._s(t.letter))]),e._v(" "),e._l(t.data,function(t,s){return[n("el-menu-item",{key:t.friendUserId,attrs:{route:{name:"UserInfo",params:{userId:t.friendUserId}},index:e._f("toString")(t.friendUserId)}},[e._v(e._s(t.nickname))])]})],2)]})],2)],1)],1)],1)],1)])},staticRenderFns:[]};var m=n("U5Ua")(l,d,!1,function(e){n("mzmZ")},"data-v-fd1bc332",null).exports,f=n("k5fI"),p={name:"ConversationItem",props:["conversation"],data:function(){return{}},computed:r()({},Object(a.b)(["objGroups","objFriends","userId"]),{info:function(){var e=this.conversation,t={targetId:e.targetId,conversationType:e.conversationType,sentTime:e.latestMessage.sentTime,unreadMessageCount:e.unreadMessageCount,latestMessage:e.latestMessage};switch(e.conversationType){case 1:t.isExist=!!this.objFriends[e.targetId],t.headimgurl=this.objFriends[e.targetId]&&this.objFriends[e.targetId].headimgurl,t.nickname=this.objFriends[e.targetId]&&this.objFriends[e.targetId].nickname;break;case 3:t.isExist=!!this.objGroups[e.targetId],t.headimgurl=this.objGroups[e.targetId]&&this.objGroups[e.targetId].groupHeadimgurl,t.nickname=this.objGroups[e.targetId]&&this.objGroups[e.targetId].groupName}var n=e.latestMessage.content;switch(e.latestMessage.objectName){case"RC:TxtMsg":var s=n.content.replace(/</gi,"&lt;").replace(/>/gi,"&gt;");RongIMLib.RongIMEmoji&&RongIMLib.RongIMEmoji.emojiToHTML&&(s=RongIMLib.RongIMEmoji.emojiToHTML(s)),t.msgContent=s;break;case"RC:ImgMsg":t.msgContent="[图片]";break;case"RC:VcMsg":t.msgContent="[语音]";break;case"RC:ImgTextMsg":t.msgContent="[图文]";break;case"RC:LBSMsg":t.msgContent="[位置]";break;case"RC:FileMsg":t.msgContent="[文件]";break;case"RC:CmdNtf":case"RC:ContactNtf":t.msgContent="[通知消息]";break;case"RC:RcCmd":t.msgContent="[一条消息被撤回]";break;case"RC:InfoNtf":case"RC:GrpNtf":t.msgContent=n.message}return t.latestMessage.content=n,t}}),filters:{humanizeTime:function(e,t){var n="";return t&&e-t<18e4?n:n=f(f(e).format("YYYY-MM-DD HH:mm:ss")).isBetween(f().format("YYYY-MM-DD"),f().format("YYYY-MM-DD HH:mm:ss"))?f(e).format("HH:mm"):f(e).format("M-D")}},created:function(){}},g={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.info.isExist?n("router-link",{staticClass:"conversation",attrs:{to:{name:"Chat",params:{targetId:e.info.targetId,conversationType:e.info.conversationType}}}},[n("div",{staticClass:"face"},[n("img",{attrs:{src:e.info.headimgurl,alt:""}})]),e._v(" "),n("div",{staticClass:"info"},[n("div",{staticClass:"name"},[e._v(e._s(e.info.nickname))]),e._v(" "),n("div",{staticClass:"msg",domProps:{innerHTML:e._s(e.info.msgContent)}})]),e._v(" "),n("div",{staticClass:"extra"},[n("div",{staticClass:"date"},[e._v(e._s(e._f("humanizeTime")(e.info.sentTime)))]),e._v(" "),e.info.unreadMessageCount?n("div",{staticClass:"num"},[e._v(e._s(e.info.unreadMessageCount))]):e._e()])]):e._e()},staticRenderFns:[]};var h=n("U5Ua")(p,g,!1,function(e){n("kBom")},"data-v-90525922",null).exports,v=n("k5fI"),I={name:"Conversations",components:{ConversationItem:h},computed:r()({},Object(a.b)(["conversations","objGroups","objFriends"])),data:function(){return{myConversations:function(){}}},filters:{humanizeTime:function(e,t){var n="";return t&&e-t<18e4?n:n=v(v(e).format("YYYY-MM-DD HH:mm:ss")).isBetween(v().format("YYYY-MM-DD"),v().format("YYYY-MM-DD HH:mm:ss"))?v(e).format("HH:mm"):v(e).format("M-D")}},created:function(){this.$store.dispatch("getMyFriends",{applyStatus:"passed"}).then(function(e){}),this.$store.dispatch("getMyGroups").then(function(e){})}},b={render:function(){var e=this.$createElement,t=this._self._c||e;return t("el-aside",{staticClass:"conversations-bar",staticStyle:{height:"100%"},attrs:{width:"330px"}},[t("ul",{staticClass:"conversation-list"},this._l(this.conversations,function(e,n){return t("li",{key:n,staticClass:"conversation-item"},[t("conversation-item",{attrs:{conversation:e}})],1)}))])},staticRenderFns:[]};var C=n("U5Ua")(I,b,!1,function(e){n("4OVt")},"data-v-068a45da",null).exports,y={},M=n("Hcuw"),_=n.n(M),T=n("h8zl"),R=n.n(T),j=n("mrFq"),k=n.n(j),E=n("TxxP"),S=n.n(E),w=k.a.create({baseURL:"/api",timeout:12e5});w.interceptors.request.use(function(e){return e.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",e.headers.token=X.getters.token,e.headers.userId=X.getters.userId,e},function(e){console.log(e),_.a.reject(e)}),w.interceptors.response.use(function(e){if(!e.data||!e.data.code)return console.log(e),e.data;if(-1!==[410].indexOf(e.data.code))location.href="http://www2.btclass.cn/admin/sealtalk";else if(200!==e.data.code)return Object(E.Message)({message:e.data.tip||e.data.msg,type:"error",duration:5e3}),_.a.reject(e.data);return e.data.res},function(e){return console.log(e),Object(E.Message)({message:e.message||"网络异常",type:"error",duration:5e3}),_.a.reject(e)});var U=w;var N={state:{myFriends:[],groupFriends:[],objFriends:{},friendInfo:{}},mutations:{SET_MY_FRIENDS:function(e,t){e.myFriends=t},SET_GROUP_FRIENDS:function(e,t){e.groupFriends=function(e){if(!String.prototype.localeCompare)return null;var t="*abcdefghjklmnopqrstwxyz".split(""),n="阿八嚓哒妸发旮哈讥咔垃麻拏噢妑七呥扨它穵夕丫帀".split(""),s=[],o=void 0;return t.forEach(function(t,r){o={letter:t,data:[]},e.forEach(function(e){(!n[r-1]||n[r-1].localeCompare(e.nickname,"zh-Hans-CN",{sensitivity:"accent"})<=0)&&-1===e.nickname.localeCompare(n[r],"zh-Hans-CN",{sensitivity:"accent"})&&o.data.push(e)}),o.data.length&&(s.push(o),o.data.sort(function(e,t){return e.nickname.localeCompare(t.nickname,"zh-Hans-CN",{sensitivity:"accent"})}))}),s}(t)},SET_OBJ_FRIENDS:function(e,t){var n=!0,o=!1,r=void 0;try{for(var a,i=R()(t);!(n=(a=i.next()).done);n=!0){var c=a.value;s.default.set(e.objFriends,c.friendUserId,c)}}catch(e){o=!0,r=e}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}},UPDATE_OBJ_FRIENDS:function(e,t){s.default.set(e.objFriends,t.userId,t)},SET_FRIEND_INFO:function(e,t){e.friendInfo=t}},actions:{getMyFriends:function(e,t){var n=e.commit,s=e.state;if(s.myFriends&&s.myFriends.length)return _.a.resolve(s.myFriends);(function(e){return U({url:"/friends",method:"get",params:{applyStatus:e.applyStatus}})})(t).then(function(e){return n("SET_MY_FRIENDS",e),n("SET_GROUP_FRIENDS",e),n("SET_OBJ_FRIENDS",e),e})},getFriendInfo:function(e,t){var n=e.commit,s=e.state;return s.objFriends[t.userId]?_.a.resolve(s.objFriends[t.userId]):function(e){return U({url:"/users/"+e.userId+"/profile",method:"get",params:{groupId:e.groupId}})}(t).then(function(e){return n("SET_FRIEND_INFO",e),n("UPDATE_OBJ_FRIENDS",e),e})},applyFriend:function(e,t){e.commit,e.state;return function(e){return U({url:"/friends/apply",method:"post",data:{friendUserId:e.friendUserId,applyReason:e.applyReason,remark:e.remark,applyFrom:e.applyFrom,fromRemark:e.fromRemark}})}(t).then(function(e){return e})}},getters:{myFriends:function(e){return e.myFriends},groupFriends:function(e){return e.groupFriends},objFriends:function(e){return e.objFriends}}},O=n("Bm5P"),F=n.n(O),G=n("mOK0"),D=n.n(G);var H={state:{myGroups:[],objGroups:{}},mutations:{SET_MY_GROUPS:function(e,t){e.myGroups=t},SET_OBJ_GROUPS:function(e,t){var n=!0,o=!1,r=void 0;try{for(var a,i=R()(t);!(n=(a=i.next()).done);n=!0){var c=a.value;e.objGroups[c.groupId]?e.objGroups[c.groupId]=D()({},e.objGroups[c.groupId],c):s.default.set(e.objGroups,c.groupId,c)}}catch(e){o=!0,r=e}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}},SET_GROUP_MEMBERS:function(e,t){var n=F()(t,2),o=n[0],r=n[1];e.objGroups[o]||s.default.set(e.objGroups,o,{}),s.default.set(e.objGroups[o],"members",r)},SET_GROUP_INFO:function(e,t){var n=F()(t,2),o=n[0],r=n[1];e.objGroups[o]||s.default.set(e.objGroups,o,{}),e.objGroups[o]=D()({},e.objGroups[o],r),s.default.set(e.objGroups[o],"info",r)},SET_MY_GROUP_SETTING:function(e,t){var n=F()(t,2),o=n[0],r=n[1];e.objGroups[o]||s.default.set(e.objGroups,o,{}),s.default.set(e.objGroups[o],"mySetting",r)}},actions:{getMyGroups:function(e){var t=e.commit,n=e.state;return n.myGroups&&n.myGroups.length?_.a.resolve(n.myGroups):U({url:"/groups/list/self",method:"get"}).then(function(e){return t("SET_MY_GROUPS",e),t("SET_OBJ_GROUPS",e),e})},getGroupInfo:function(e,t){var n=e.commit,s=e.state;return s.objGroups[t]&&s.objGroups[t].info?s.objGroups[t].info:function(e){return U({url:"/groups/"+e+"/info",method:"get"})}(t).then(function(e){return n("SET_GROUP_INFO",[t,e[0]]),e[0]})},getGroupMembers:function(e,t){var n=e.commit,s=e.state;return s.objGroups[t]&&s.objGroups[t].members?s.objGroups[t].members:function(e){return U({url:"/groups/"+e+"/members",method:"get"})}(t).then(function(e){return n("SET_GROUP_MEMBERS",[t,e]),e})},getMyGroupSetting:function(e,t){var n=e.commit,s=e.state;return s.objGroups[t]&&s.objGroups[t].mySetting?s.objGroups[t].mySetting:function(e){return U({url:"/groups/"+e+"/mysetting",method:"get"})}(t).then(function(e){return n("SET_MY_GROUP_SETTING",[t,e]),e})},updateGroupSetting:function(e,t){var n,s,o=e.dispatch;return(n=t.groupId,s=t,U({url:"/groups/"+n+"/mysetting",method:"post",data:s})).then(function(e){return o("getGroupInfo",t.groupId),e})}},getters:{myGroups:function(e){return e.myGroups},objGroups:function(e){return e.objGroups}}},$=n("qWzu"),L=n.n($),Y=function(e){return!!window.sessionStorage&&(Boolean(window.sessionStorage&&window.sessionStorage.hasOwnProperty(e))?JSON.parse(window.sessionStorage.getItem(e)):null)},z=function(e,t){return!!window.sessionStorage&&(window.sessionStorage.setItem(e,L()(t)),!0)},A=function(e){return Boolean(window.sessionStorage&&window.sessionStorage.hasOwnProperty(e))},B=function(e){return!!window.localStorage&&(Boolean(window.localStorage&&window.localStorage.hasOwnProperty(e))?JSON.parse(window.localStorage.getItem(e)):null)},P=function(e,t){return!!window.localStorage&&(window.localStorage.setItem(e,L()(t)),!0)};var V={state:{token:"",userId:0,userInfo:{},curSidebar:""},mutations:{SET_TOKEN:function(e,t){e.token=t,P("token",t)},SET_USER_ID:function(e,t){e.userId=t,P("userId",t)},SET_USER_INFO:function(e,t){e.userInfo=t},SET_CUR_SIDEBAR:function(e,t){z("curSidebar",t),e.curSidebar=t}},actions:{getUserProfile:function(e){var t=e.commit,n=e.state;return n.userInfo&&n.userInfo.userId?_.a.resolve(n.userInfo):U({url:"/users/"+X.getters.userId+"/profile",method:"get"}).then(function(e){return t("SET_USER_INFO",e),e})}},getters:{token:function(e){return e.token||B("token")||""},userId:function(e){return e.userId||B("userId")||0},userInfo:function(e){return e.userInfo},curSidebar:function(e){return e.curSidebar||Y("curSidebar")||"Conversations"}}},q=n("Kq7y"),Q=n.n(q),K={1:RongIMLib.ConversationType.PRIVATE,2:RongIMLib.ConversationType.DISCUSSION,3:RongIMLib.ConversationType.GROUP,4:RongIMLib.ConversationType.CHATROOM,5:RongIMLib.ConversationType.CUSTOMER_SERVICE,6:RongIMLib.ConversationType.SYSTEM,7:RongIMLib.ConversationType.APP_PUBLIC_SERVICE,8:RongIMLib.ConversationType.PUBLIC_SERVICE};var J=function(e,t,n,s){var o=K[e];return new _.a(function(e,r){RongIMClient.getInstance().sendMessage(o,t,n,{onSuccess:function(t){console.log("Send successfully"),e(t)},onError:function(e,t){var n="";switch(e){case RongIMLib.ErrorCode.TIMEOUT:n="超时";break;case RongIMLib.ErrorCode.UNKNOWN_ERROR:n="未知错误";break;case RongIMLib.ErrorCode.REJECTED_BY_BLACKLIST:n="在黑名单中，无法向对方发送消息";break;case RongIMLib.ErrorCode.NOT_IN_DISCUSSION:n="不在讨论组中";break;case RongIMLib.ErrorCode.NOT_IN_GROUP:n="不在群组中";break;case RongIMLib.ErrorCode.NOT_IN_CHATROOM:n="不在聊天室中";break;default:n=x}console.log("发送失败:"+n),Object(E.Message)({message:"发送失败:"+n,type:"error",duration:5e3}),r(n)}},s)})},W={state:{rcToken:"",initStatus:!1,unreadCount:0,conversations:[],curConversation:{conversationType:0,targetId:0,hasMsg:!0,histories:[],newMsg:0},rcHistories:{}},mutations:{SET_RC_TOKEN:function(e,t){e.rcToken=t},SET_INIT_STATUS:function(e,t){e.initStatus=t},SET_UNREAD_COUNT:function(e,t){e.unreadCount=t},RESET_UNREAD_COUNT:function(e){var t=0;e.conversations.map(function(e){t+=e.unreadMessageCount}),e.unreadCount=t},UPDATE_UNREAD_COUNT:function(e,t){e.unreadCount=e.unreadCount+t},SET_CONVERSATIONS:function(e,t){e.conversations=t},SET_CUR_CONVERSATION:function(e,t){e.curConversation=D()({},e.curConversation,t)},ADD_OLD_HISTORY:function(e,t){var n,s=F()(t,2),o=s[0],r=s[1];(n=e.curConversation.histories).unshift.apply(n,Q()(o)),e.curConversation.hasMsg=r},ADD_NEW_HISTORY:function(e,t){e.curConversation.histories.push(t);var n=t.conversationType+"-"+t.targetId;e.rcHistories[n]?e.rcHistories[n].histories.push(t):e.rcHistories[n]={histories:[t],hasMsg:!0}},ADD_CONVERSATIONS:function(e,t){e.conversations.push(t)},CLEAR_UNREAD_COUNT:function(e,t){for(var n in e.conversations)if(e.conversations[n].targetId==t.targetId){e.conversations[n].unreadCount=0;break}},RECEIVE_NEW_MESSAGE:function(e,t){if("RC:TypSts"!=t.objectName){console.log("---RECEIVE_NEW_MESSAGE---");for(var n in e.conversations)if(e.conversations[n].targetId==t.targetId){n,e.conversations[n].latestMessage=t,e.conversations[n].sentTime=t.sentTime,e.conversations[n].sentStatus=t.sentStatus,e.conversations[n].objectName=t.objectName,e.conversations[n].notificationStatus=t.sentStatus,e.conversations[n].latestMessageId=t.messageId;break}e.curConversation.targetId==t.targetId&&(e.curConversation.histories.push(t),e.curConversation.newMsg++);var s=t.conversationType+"-"+t.targetId;e.rcHistories[s]?e.rcHistories[s].histories.push(t):e.rcHistories[s]={histories:[t],hasMsg:!0},console.log("histories.length",e.curConversation.histories.length)}},SET_HISTORIES:function(e,t){var n,s=t.conversationType+"-"+t.targetId;e.rcHistories[s]?((n=e.rcHistories[s].histories).unshift.apply(n,Q()(t.histories)),e.rcHistories[s].hasMsg=t.hasMsg):e.rcHistories[s]={histories:t.histories,hasMsg:t.hasMsg}}},actions:{getRCToken:function(e){var t=e.commit,n="rcToken";return A(n)?(t("SET_RC_TOKEN",Y(n)),_.a.resolve(Y(n))):U({url:"/users/token",method:"get"}).then(function(e){return t("SET_RC_TOKEN",e.token),z(n,e.token),e.token})},getHistoryMsg:function(e,t){var n=e.commit,s=e.state,o=s.curConversation.conversationType+"-"+s.curConversation.targetId;return s.rcHistories[o]&&t.first?(n("SET_CUR_CONVERSATION",JSON.parse(L()(s.rcHistories[o]))),_.a.resolve(s.curConversation)):s.curConversation.histories&&!s.curConversation.hasMsg?_.a.resolve(s.curConversation):function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,o=K[e];return new _.a(function(e,r){RongIMLib.RongIMClient.getInstance().getHistoryMessages(o,t,n,s,{onSuccess:function(t,n){e([t,n])},onError:function(e){console.log("GetHistoryMessages,errorcode:"+e),r(e)}})})}(s.curConversation.conversationType,s.curConversation.targetId,t.timestramp,t.limit).then(function(e){var t=F()(e,2),o=t[0],r=t[1];return n("ADD_OLD_HISTORY",[o,r]),n("SET_HISTORIES",{conversationType:s.curConversation.conversationType,targetId:s.curConversation.targetId,histories:o,hasMsg:r}),s.curConversation})},sendTextMsg:function(e,t){var n,s,o,r,a,i=e.commit;e.state;return(n=t.conversationType,s=t.targetId,o=t.message,r=t.at,a=new RongIMLib.TextMessage(o),J(n,s,a,r).then(function(e){return e})).then(function(e){return i("ADD_NEW_HISTORY",e),e})},sendImageMsg:function(e,t){var n,s,o,r,a,i=e.commit;e.state;return(n=t.conversationType,s=t.targetId,o=t.message,r=t.at,a=new RongIMLib.ImageMessage(o),J(n,s,a,r).then(function(e){return e})).then(function(e){return i("ADD_NEW_HISTORY",e),e})},clearUnreadCount:function(e,t){var n,s,o,r=e.commit;return(n=t.conversationType,s=t.targetId,o=K[n],new _.a(function(e,t){RongIMClient.getInstance().clearUnreadCount(o,s,{onSuccess:function(){e()},onError:function(e){t(e)}})})).then(function(){return r("CLEAR_UNREAD_COUNT",t),!0})}},getters:{rcToken:function(e){return e.rcToken},initStatus:function(e){return e.initStatus},unreadCount:function(e){return e.unreadCount},conversations:function(e){return e.conversations},curConversation:function(e){return e.curConversation},rcHistories:function(e){return e.rcHistories}}};s.default.use(a.a);var Z=new a.a.Store({modules:{friend:N,group:H,user:V,rc:W},getters:y});Z.subscribe(function(e,t){"RECEIVE_NEW_MESSAGE"==e.type&&t.rc.curConversation.targetId==e.payload.targetId&&Z.dispatch("clearUnreadCount",t.rc.curConversation).then(function(e){})});var X=Z;var ee={name:"App",components:{Sidebar:u,Contacts:m,Conversations:C},computed:r()({},Object(a.b)(["rcToken","curSidebar"])),methods:{},created:function(){var e=this;this.$store.dispatch("getUserProfile").then(function(e){}),this.$store.dispatch("getRCToken").then(function(t){var n=e;!function(e,t,n){var s=e.appKey,o=e.token,r=e.navi||"",a=(n=n||{}).RongIMLib||window.RongIMLib,i=a.RongIMClient,c=n.protobuf||null,u={};""!==r&&(u.navi=r);var l=e.api||"";""!==l&&(u.api=l),null!=c&&(u.protobuf=c),a.RongIMClient.init(s,null,u);var d=i.getInstance();i.setConnectionStatusListener({onChanged:function(e){switch(console.log(e),e){case a.ConnectionStatus.CONNECTED:case 0:console.log("连接成功"),t.getInstance&&t.getInstance(d);break;case a.ConnectionStatus.CONNECTING:case 1:console.log("连接中");break;case a.ConnectionStatus.DISCONNECTED:case 2:console.log("当前用户主动断开链接");break;case a.ConnectionStatus.NETWORK_UNAVAILABLE:case 3:console.log("网络不可用"),Object(E.Message)({message:"网络不可用",type:"error",duration:5e3});break;case a.ConnectionStatus.CONNECTION_CLOSED:case 4:console.log("未知原因，连接关闭"),Object(E.Message)({message:"未知原因，连接关闭",type:"error",duration:5e3});break;case a.ConnectionStatus.KICKED_OFFLINE_BY_OTHER_CLIENT:case 6:console.log("用户账户在其他设备登录，本机会被踢掉线"),Object(E.Message)({message:"用户账户在其他设备登录，本机会被踢掉线",type:"error",duration:5e3});break;case a.ConnectionStatus.DOMAIN_INCORRECT:case 12:console.log("当前运行域名错误，请检查安全域名配置")}}}),i.setOnReceiveMessageListener({onReceived:function(e){switch(e.messageType){case i.MessageType.TextMessage:case i.MessageType.VoiceMessage:case i.MessageType.ImageMessage:case i.MessageType.RichContentMessage:case i.MessageType.DiscussionNotificationMessage:case i.MessageType.LocationMessage:case i.MessageType.InformationNotificationMessage:case i.MessageType.ContactNotificationMessage:case i.MessageType.ProfileNotificationMessage:case i.MessageType.CommandNotificationMessage:case i.MessageType.CommandMessage:case i.MessageType.UnknownMessage:}t.receiveNewMessage&&t.receiveNewMessage(e)}}),i.connect(o,{onSuccess:function(e){t.getCurrentUser&&t.getCurrentUser({userId:e}),console.log("链接成功，用户id："+e),X.commit("SET_INIT_STATUS",!0)},onTokenIncorrect:function(){console.log("token无效")},onError:function(e){console.log(e)}})}({appKey:"sfci50a7s4woi",token:e.rcToken},{getInstance:function(t){console.log("---instance---"),new _.a(function(e,t){RongIMClient.getInstance().getConversationList({onSuccess:function(t){e(t)},onError:function(e){t(e)}},null)}).then(function(t){e.$store.commit("SET_CONVERSATIONS",t)}),new _.a(function(e,t){RongIMClient.getInstance().getTotalUnreadCount({onSuccess:function(t){e(t)},onError:function(e){t(e)}})}).then(function(t){e.$store.commit("SET_UNREAD_COUNT",t)})},receiveNewMessage:function(e){console.log("---receiveNewMessage---message:",e,n.$store.getters.conversations[0].unreadMessageCount),n.$store.commit("RECEIVE_NEW_MESSAGE",e)},getCurrentUser:function(e){e.userId}})})}},te={render:function(){var e=this.$createElement,t=this._self._c||e;return t("el-container",{attrs:{id:"app"}},[t("el-aside",{staticStyle:{overflow:"hidden"},attrs:{width:"400px"}},[t("Sidebar"),this._v(" "),t(this.curSidebar,{tag:"component"})],1),this._v(" "),t("el-main",[t("router-view")],1)],1)},staticRenderFns:[]};var ne=n("U5Ua")(ee,te,!1,function(e){n("pgi2")},null,null).exports,se=n("byqf"),oe={render:function(){var e=this.$createElement;return(this._self._c||e)("div")},staticRenderFns:[]};var re=n("U5Ua")({name:"Index",data:function(){return{}}},oe,!1,function(e){n("Pl+j")},"data-v-1dd4d75a",null).exports,ae={name:"UserInfo",components:{},props:["userId","applyFrom","fromRemark"],data:function(){return{conversationType:"1",friendInfo:{}}},created:function(){this.fetchUserInfo()},methods:{fetchUserInfo:function(){var e=this,t={userId:this.userId};this.$store.dispatch("getFriendInfo",t).then(function(t){e.friendInfo=t})},toChat:function(){this.$router.push({name:"Chat",params:{conversationType:this.conversationType,targetId:this.userId}})},back:function(){history.back()},toApplyFriend:function(){this.$router.push({name:"ApplyFriend",params:{friendUserId:this.userId},query:{applyFrom:this.applyFrom,fromRemark:this.fromRemark}})}},watch:{userId:function(e){this.fetchUserInfo()}}},ie={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-header",[n("el-button",{staticClass:"btn-left",attrs:{icon:"el-icon-arrow-left"},on:{click:function(t){e.back()}}}),e._v(" "),n("h3",{staticClass:"title"},[e._v("好友信息")])],1),e._v(" "),n("el-main",[n("div",{staticClass:"user-info"},[n("div",{staticClass:"user-data"},[n("div",{staticClass:"photo"},[n("img",{attrs:{src:e.friendInfo.headimgurl,alt:""}})]),e._v(" "),n("div",{staticClass:"info"},[n("h3",{staticClass:"username"},[e._v(e._s(e.friendInfo.nickname))]),e._v(" "),n("p",{staticClass:"studentid"},[e._v(e._s(e.friendInfo.studentid))])])])]),e._v(" "),e.friendInfo.isFriend||"passed"==e.friendInfo.applyStatus?n("div",{staticClass:"operate-block"},[n("el-button",{attrs:{type:"text"},on:{click:function(t){e.toChat()}}},[e._v("发消息")])],1):n("div",{staticClass:"operate-block"},[n("el-button",{attrs:{type:"text"},on:{click:function(t){e.toApplyFriend()}}},[e._v("申请好友")])],1)])],1)},staticRenderFns:[]};var ce=n("U5Ua")(ae,ie,!1,function(e){n("eQon")},"data-v-39e22dc0",null).exports,ue={name:"GroupInfo",components:{},props:["groupId"],data:function(){return{conversationType:"3",groupInfo:{},groupMembers:[],myGroupSetting:{}}},created:function(){this.fetchGroupInfo()},methods:{fetchGroupInfo:function(){var e=this;this.$store.dispatch("getGroupInfo",this.groupId).then(function(t){e.groupInfo=t}),this.$store.dispatch("getGroupMembers",this.groupId).then(function(t){e.groupMembers=t}),this.$store.dispatch("getMyGroupSetting",this.groupId).then(function(t){e.myGroupSetting=t})},toChat:function(){this.$router.push({name:"Chat",params:{conversationType:this.conversationType,targetId:this.groupId}})},toBulletin:function(){this.$router.push({name:"Bulletin",params:{groupId:this.groupId}})},back:function(){history.back()}},watch:{groupId:function(){this.fetchGroupInfo()}}},le={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-header",[n("el-button",{staticClass:"btn-left",attrs:{icon:"el-icon-arrow-left"},on:{click:function(t){e.back()}}}),e._v(" "),n("h3",{staticClass:"title"},[e._v("群资料")])],1),e._v(" "),n("el-main",[n("div",{staticClass:"user-info"},[n("div",{staticClass:"group-data"},[n("div",{staticClass:"photo"},[n("img",{attrs:{src:e.groupInfo.groupHeadimgurl,alt:""}})]),e._v(" "),n("div",{staticClass:"info"},[n("h3",{staticClass:"name"},[e._v(e._s(e.groupInfo.groupName))]),e._v(" "),n("p",{staticClass:"num"},[e._v("群成员 "+e._s(e.groupInfo.num)+" 人")])])])]),e._v(" "),n("div",{staticClass:"operate-block"},[n("el-button",{attrs:{type:"text"},on:{click:function(t){e.toChat()}}},[e._v("发群聊")])],1),e._v(" "),n("div",{staticClass:"operate-block"},[n("el-button",{attrs:{type:"text"},on:{click:function(t){e.toBulletin()}}},[e._v("群公告")])],1),e._v(" "),n("ul",{staticClass:"group-member-list"},e._l(e.groupMembers,function(t,s){return n("li",{key:t.userId,staticClass:"group-member-item"},[n("router-link",{staticClass:"member-card",attrs:{to:{name:"UserInfo",params:{userId:t.userId},query:{applyFrom:"group",fromRemark:e.groupId}}}},[n("div",{staticClass:"face"},[n("img",{attrs:{src:t.headimgurl,alt:""}})]),e._v(" "),n("div",{staticClass:"info"},[n("div",{staticClass:"name"},[e._v(e._s(t.nickname))])])])],1)}))])],1)},staticRenderFns:[]};var de=n("U5Ua")(ue,le,!1,function(e){n("QyKp")},"data-v-5f0ee923",null).exports,me={name:"Emoji",props:{value:Boolean},data:function(){return{emojoList:{}}},created:function(){this.emojoList=RongIMLib.RongIMEmoji.list},methods:{symbolToHTML:function(e){if(RongIMLib.RongIMEmoji&&RongIMLib.RongIMEmoji.symbolToHTML)return RongIMLib.RongIMEmoji.symbolToHTML(e)},handleInput:function(e){this.$emit("execCommandEmojo",e.symbol)}},mounted:function(){var e=this;this.globalClick(function(t){e.$refs.emojoBox&&!e.$refs.emojoBox.contains(t.target)&&(console.log("globalClick-update:value"),e.$emit("update:value",!1))})}},fe={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.value?n("div",{ref:"emojoBox",staticClass:"emojo-box"},[e._l(e.emojoList,function(t,s){return[n("span",{staticClass:"emojo",domProps:{innerHTML:e._s(e.symbolToHTML(t.symbol))},on:{click:function(n){e.handleInput(t)}}})]})],2):e._e()},staticRenderFns:[]};var pe=n("U5Ua")(me,fe,!1,function(e){n("2gkG")},"data-v-3b6bc5b9",null).exports;var ge=n("U7mS"),he={name:"RcImage",props:{},computed:r()({},Object(a.b)(["userId"])),data:function(){return{percentage:0,image:{key:"",content:"",imageUri:""}}},created:function(){},methods:{uploadToQiniu:function(e){var t=this,n=e.target.files[0];n&&ge(n).then(function(e){var s=new FormData;s.append("file",e.file,n.name),U({url:"/qinius/token",method:"get"}).then(function(o){s.append("token",o.token),s.append("key","sealtalk/"+t.userId+"/"+n.name);k.a.post("https://upload.qiniu.com/",s,{headers:{"Content-Type":"multipart/form-data"}}).then(function(n){console.log("-----上传图片成功---",n),t.image.key=n.data.key,t.image.imageUri=n.data.url,t.image.content=e.base64.replace("data:image/jpeg;base64,",""),t.$emit("execCommandImage",t.image)}).catch(function(e){console.log("-----上传图片失败---",e)})}).catch(function(e){console.log("获取token失败",e)})}).catch(function(e){console.log("压缩图片失败",e)})}}},ve={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"choice-block"},[t("input",{staticClass:"choice-image",attrs:{id:"file",type:"file",accept:"image/*"},on:{change:this.uploadToQiniu}}),this._v(" "),t("label",{staticClass:"file-label",attrs:{for:"file"}},[t("icon",{attrs:{name:"image"}})],1)])},staticRenderFns:[]};var Ie=n("U5Ua")(he,ve,!1,function(e){n("g3V2")},"data-v-73dfe616",null).exports,be=(n("k5fI"),{name:"Message",props:{rcMessage:{type:Object,default:{}},owner:{type:Object,default:{}},isMe:{type:Boolean}},data:function(){return{isPlayVoice:!1}},computed:{handledMessage:function(){var e=this.rcMessage,t=e.content;switch(e.objectName){case"RC:TxtMsg":var n=t.content.replace(/</gi,"&lt;").replace(/>/gi,"&gt;");RongIMLib.RongIMEmoji&&RongIMLib.RongIMEmoji.emojiToHTML&&(n=RongIMLib.RongIMEmoji.emojiToHTML(n)),e.html=n;break;case"RC:ImgMsg":e.html="data:image/png;base64,"+t.content;break;case"RC:VcMsg":e.html="[语音]";break;case"RC:ImgTextMsg":e.html="[图文]";break;case"RC:LBSMsg":e.html="[位置]";break;case"RC:FileMsg":e.html="[文件]";break;case"RC:CmdNtf":case"RC:ContactNtf":e.html="[通知消息]";break;case"RC:InfoNtf":case"RC:GrpNtf":e.html=t.message;break;case"RC:DizNtf":break;case"RC:RcCmd":e.html="消息被撤回"}return e}},created:function(){},methods:{previewImage:function(e){this.$emit("showDialogImage",e)},playVoice:function(e){this.isPlayVoice=!0;var t=this,n=e.content.content,s=n.length/1024;RongIMLib.RongIMVoice.preLoaded(n,function(){RongIMLib.RongIMVoice.play(n,s),setTimeout(function(){t.isPlayVoice=!1},1e3*e.content.duration)})}}}),Ce={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.rcMessage?n("div",{staticClass:"msg-card"},["RC:InfoNtf"==e.rcMessage.objectName?[n("div",{staticClass:"info-ntf"},[e._v(e._s(e.rcMessage.content.message))])]:["RC:TxtMsg","RC:ImgMsg","RC:VcMsg"].indexOf(e.rcMessage.objectName)>-1?[n("div",{staticClass:"normal-ntf",class:{me:e.isMe}},[n("div",{staticClass:"face"},[n("img",{attrs:{src:e.owner.headimgurl,alt:""}})]),e._v(" "),n("div",{staticClass:"info"},[n("div",{staticClass:"name"},[e._v(e._s(e.owner.nickname))]),e._v(" "),n("div",{staticClass:"msg"},["RC:TxtMsg"==e.rcMessage.objectName?n("pre",{staticClass:"text-msg",domProps:{innerHTML:e._s(e.handledMessage.html)}}):"RC:ImgMsg"==e.rcMessage.objectName?n("img",{staticClass:"img-msg",attrs:{src:e.handledMessage.html},on:{click:function(t){e.previewImage(e.handledMessage.html)}}}):"RC:VcMsg"==e.rcMessage.objectName?n("div",[n("div",{staticClass:"voice-msg",on:{click:function(t){e.playVoice(e.rcMessage)}}},[n("span",{staticClass:"icon",class:{playing:e.isPlayVoice}}),e._v(" "),n("span",{staticClass:"duration"},[e._v(e._s(e.rcMessage.content.duration)+"'")])])]):n("div",[e._v("[其他消息]")])])])])]:"RC:TypSts"==e.rcMessage.objectName?void 0:"RC:RcCmd"==e.rcMessage.objectName?[n("div",{staticClass:"info-ntf",domProps:{innerHTML:e._s(e.handledMessage.html)}})]:[n("div",[e._v("\n      "+e._s(e.rcMessage.objectName)+"\n    ")])]],2):e._e()},staticRenderFns:[]};var ye=n("U5Ua")(be,Ce,!1,function(e){n("A+DQ")},"data-v-08e813aa",null).exports,Me=n("k5fI"),_e={name:"Chat",components:{Message:ye,Emojo:pe,RcImage:Ie},props:{conversationType:{type:Number},targetId:{type:String}},data:function(){return{$replyText:null,$chatroom:null,chatInfo:{title:""},replyText:"",page:{first:!0,timestrap:null,limit:20,loading:!1},chatMembers:{},showEmojo:!1,previewDialogVisible:!1,dialogImageUrl:""}},computed:r()({},Object(a.b)(["initStatus","userInfo","curConversation","userId"])),created:function(){this.page.first=!0;var e={conversationType:this.conversationType,targetId:this.targetId,hasMsg:!0,histories:[]};this.$store.commit("SET_CUR_CONVERSATION",e),this.fetchChatMembers();var t=this,n=setInterval(function(){t.initStatus&&(clearInterval(n),t.fetchLatestMessage(),t.clearUnreadCount())},500)},mounted:function(){this.$chatroom=document.getElementById("chatroom"),this.$chatroom.addEventListener("scroll",this.fetchHistoricalMessage),this.$replyText=document.getElementById("replyText")},methods:{back:function(){history.back()},atMember:function(){console.log("---@---")},showDialogImage:function(e){this.dialogImageUrl=e,this.previewDialogVisible=!0},toInfo:function(){1==this.conversationType?this.$router.push({name:"UserInfo",params:{userId:this.targetId}}):3==this.conversationType&&this.$router.push({name:"GroupInfo",params:{groupId:this.targetId}})},clearUnreadCount:function(){this.$store.dispatch("clearUnreadCount",this.curConversation).then()},fetchChatMembers:function(){var e=this;if(1==this.conversationType){var t={userId:this.targetId};this.$store.dispatch("getFriendInfo",t).then(function(t){e.chatInfo.title=t.nickname,e.$set(e.chatMembers,e.targetId,{nickname:t.nickname,headimgurl:t.headimgurl,userId:t.userId})})}else 3==this.conversationType&&(this.$store.dispatch("getGroupInfo",this.targetId).then(function(t){e.chatInfo.title=t.groupName}),this.$store.dispatch("getGroupMembers",this.targetId).then(function(t){var n=!0,s=!1,o=void 0;try{for(var r,a=R()(t);!(n=(r=a.next()).done);n=!0){var i=r.value;e.$set(e.chatMembers,i.userId,{userId:i.userId,nickname:i.nickname,headimgurl:i.headimgurl})}}catch(e){s=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(s)throw o}}}));this.$store.dispatch("getUserProfile").then(function(t){e.$set(e.chatMembers,t.userId,{userId:t.userId,nickname:t.nickname,headimgurl:t.headimgurl})})},symbolToEmoji:function(e){return RongIMLib.RongIMEmoji&&RongIMLib.RongIMEmoji.symbolToEmoji?RongIMLib.RongIMEmoji.symbolToEmoji(e):e},sendMessage:function(){var e=this,t={conversationType:this.curConversation.conversationType,targetId:this.curConversation.targetId,message:{content:this.symbolToEmoji(this.replyText.trim()),extra:""},at:!1};t.message.content&&this.$store.dispatch("sendTextMsg",t).then(function(t){e.replyText="",e.refreshChatroom()})},refreshChatroom:function(){var e=this;setTimeout(function(){e.$chatroom.scrollTop=e.$chatroom.scrollHeight},0)},fetchLatestMessage:function(){var e=this;this.$store.dispatch("getHistoryMsg",this.page).then(function(t){e.page.first=!1,e.refreshChatroom()})},fetchHistoricalMessage:function(e){var t=this;if(e.target.scrollTop<=10&&!this.page.first&&!this.page.loading&&this.curConversation.hasMsg){console.log("---fetchHistoricalMessage---"),this.page.first=!1,this.page.loading=!0;var n=this.$chatroom.scrollHeight,s=this;this.$store.dispatch("getHistoryMsg",this.page).then(function(e){setTimeout(function(){s.page.loading=!1},500),t.$chatroom.scrollTop=t.$chatroom.scrollHeight-n})}},toggleShowEmojo:function(){this.showEmojo=!this.showEmojo},execCommandEmojo:function(e){this.$replyText.focus(),document.execCommand("insertText","false",e)},sendImageMessage:function(e){var t=this,n={conversationType:this.curConversation.conversationType,targetId:this.curConversation.targetId,message:{content:e.content,uri:e.uri,extra:""},at:!1};this.$store.dispatch("sendImageMsg",n).then(function(e){console.log(e),t.refreshChatroom()})}},filters:{humanizeTime:function(e,t){var n="";return t&&e-t<18e4?n:n=Me(Me(e).format("YYYY-MM-DD HH:mm:ss")).isBetween(Me().format("YYYY-MM-DD"),Me().format("YYYY-MM-DD HH:mm:ss"))?Me(e).format("HH:mm"):Me(e).format("Y-M-D HH:mm")}},watch:{targetId:function(e,t){this.page.first=!0;var n={conversationType:this.conversationType,targetId:this.targetId,hasMsg:!0,histories:[]};this.$store.commit("SET_CUR_CONVERSATION",n),this.fetchChatMembers(),this.fetchLatestMessage(),this.clearUnreadCount()},"curConversation.newMsg":function(e,t){this.refreshChatroom()}}},Te={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-header",[n("el-button",{staticClass:"btn-left",attrs:{icon:"el-icon-arrow-left"},on:{click:function(t){e.back()}}}),e._v(" "),n("h3",{staticClass:"title"},[e._v(e._s(e.chatInfo.title))]),e._v(" "),n("el-button",{staticClass:"btn-right",attrs:{icon:"el-icon-info"},on:{click:function(t){e.toInfo()}}})],1),e._v(" "),n("el-main",{attrs:{id:"chatroom"}},[n("div",{staticClass:"message-block"},[n("ul",{staticClass:"message-list"},e._l(e.curConversation.histories,function(t,s){return n("li",{key:s,staticClass:"message-item"},[n("div",{staticClass:"msg-date"},[e._v(e._s(e._f("humanizeTime")(t.sentTime,e.curConversation.histories[s-1]&&e.curConversation.histories[s-1].sentTime)))]),e._v(" "),n("Message",{attrs:{rcMessage:t,owner:e.chatMembers[t.senderUserId]||{},isMe:t.senderUserId==e.userId},on:{showDialogImage:e.showDialogImage}})],1)}))])]),e._v(" "),n("el-footer",{attrs:{height:"130px"}},[n("div",{staticClass:"input-box"},[n("div",{staticClass:"operate-row"},[n("a",{staticClass:"operate-item",on:{click:e.toggleShowEmojo}},[n("icon",{attrs:{name:"meh-o"}}),e._v(" "),n("emojo",{on:{execCommandEmojo:e.execCommandEmojo,"update:value":function(t){return e.showEmojo=t}},model:{value:e.showEmojo,callback:function(t){e.showEmojo=t},expression:"showEmojo"}})],1),e._v(" "),n("div",{staticClass:"operate-item"},[n("rc-image",{on:{execCommandImage:e.sendImageMessage}})],1)]),e._v(" "),n("div",{staticClass:"message-form"},[n("el-input",{attrs:{id:"replyText",type:"textarea",autosize:{minRows:3,maxRows:3},placeholder:"请输入内容",resize:"none"},nativeOn:{keyup:function(t){return("button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter"))&&t.ctrlKey?e.sendMessage(t):null}},model:{value:e.replyText,callback:function(t){e.replyText=t},expression:"replyText"}}),e._v(" "),n("el-button",{staticClass:"btn-send",attrs:{type:"text"},on:{click:e.sendMessage}},[e._v("发送")])],1)])]),e._v(" "),n("el-dialog",{attrs:{visible:e.previewDialogVisible},on:{"update:visible":function(t){e.previewDialogVisible=t}}},[n("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},staticRenderFns:[]};var Re=n("U5Ua")(_e,Te,!1,function(e){n("0n6d")},"data-v-3911db94",null).exports,je={name:"Bulletin",props:{groupId:{}},data:function(){return{bulletin:"",groupInfo:{},myGroupSetting:{}}},computed:{hasBulletin:function(){return!!this.bulletin.trim()},canEdit:function(){var e=!1;return"class"==this.groupInfo.groupType||"committee"==this.groupInfo.groupType?["teacher","tutor","monitor"].indexOf(this.myGroupSetting.role)>-1&&(e=!0):"group"==this.groupInfo.groupType?["teacher","tutor","monitor","groupHead"].indexOf(this.myGroupSetting.role)>-1&&(e=!0):"free"==this.groupInfo.groupType&&["teacher","tutor"].indexOf(this.myGroupSetting.role)>-1&&(e=!0),e}},created:function(){var e=this;this.$store.dispatch("getGroupInfo",this.groupId).then(function(t){e.groupInfo=t,e.bulletin=t.notice}),this.$store.dispatch("getMyGroupSetting",this.groupId).then(function(t){e.myGroupSetting=t})},methods:{sendToAll:function(){var e=this;this.$confirm("该公告会通知全部群成员，是否发布？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t={groupId:e.groupId,notice:e.bulletin};e.$store.dispatch("updateGroupSetting",t).then(function(t){var n=new RongIMLib.MentionedInfo;n.type=RongIMLib.MentionedType.ALL,n.userIdList=[];var s={conversationType:3,targetId:e.groupId+"",message:{content:"@所有人 "+e.bulletin.trim(),extra:"",mentionedInfo:n},at:!0};e.$store.dispatch("sendTextMsg",s).then(function(t){console.log(t),e.$message({type:"success",message:"发布成功!"})}).catch(function(e){console.log(e)})})})},back:function(){history.back()}}},ke={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-header",[n("el-button",{staticClass:"btn-left",attrs:{icon:"el-icon-arrow-left"},on:{click:function(t){e.back()}}}),e._v(" "),n("h3",[e._v("群公告")])],1),e._v(" "),n("el-main",[n("div",{staticClass:"bulletin-form"},[n("el-input",{attrs:{type:"textarea",autosize:{minRows:10,maxRows:15},placeholder:"请编辑群公告"},model:{value:e.bulletin,callback:function(t){e.bulletin=t},expression:"bulletin"}}),e._v(" "),n("div",{staticClass:"text-right"},[n("el-button",{attrs:{disabled:!e.hasBulletin||!e.canEdit},on:{click:e.sendToAll}},[e._v("发布")])],1)],1)])],1)},staticRenderFns:[]};var Ee=n("U5Ua")(je,ke,!1,function(e){n("ZA1C")},"data-v-11c386e0",null).exports,Se={name:"ApplyFriend",props:["friendUserId","applyFrom","fromRemark"],data:function(){return{applyReason:"",remark:"",friendInfo:{}}},computed:r()({},Object(a.b)(["userInfo"]),{placeholder:function(){return"我是"+this.userInfo.nickname+"，赶快通过我的好友申请，一起学习交流吧～"}}),created:function(){var e=this,t={userId:this.friendUserId};this.$store.dispatch("getFriendInfo",t).then(function(t){e.friendInfo=t})},methods:{submit:function(){var e=this;this.$confirm("确认发送好友请求？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t={friendUserId:e.friendUserId,applyReason:e.applyReason.trim()||e.placeholder,remark:e.remark,applyFrom:e.applyFrom,fromRemark:e.fromRemark};e.$store.dispatch("applyFriend",t).then(function(t){console.log(t),e.$message({type:"success",message:"发送成功!"}),e.$router.replace({name:"UserInfo",params:{userId:e.friendUserId},query:{applyFrom:e.applyFrom,fromRemark:e.fromRemark}})}).catch(function(e){console.log(e)})}).catch(function(){})},back:function(){history.back()}}},we={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-header",[n("el-button",{staticClass:"btn-left",attrs:{icon:"el-icon-arrow-left"},on:{click:function(t){e.back()}}}),e._v(" "),n("h3",[e._v('申请将"'+e._s(e.friendInfo.nickname)+'"加为好友')])],1),e._v(" "),n("el-main",[n("div",{staticClass:"apply-form"},[n("p",{staticClass:"tips"},[e._v("你需要发送验证申请，等待对方通过")]),e._v(" "),n("el-input",{attrs:{type:"textarea",autosize:{minRows:10,maxRows:15},placeholder:e.placeholder},model:{value:e.applyReason,callback:function(t){e.applyReason=t},expression:"applyReason"}}),e._v(" "),n("div",{staticClass:"text-right"},[n("el-button",{on:{click:e.submit}},[e._v("发送")])],1)],1)])],1)},staticRenderFns:[]};var Ue=n("U5Ua")(Se,we,!1,function(e){n("0YEk")},"data-v-6d61cca1",null).exports,Ne={name:"SearchFriend",props:[],data:function(){return{keyword:"",select:"studentid"}},computed:r()({},Object(a.b)(["userInfo"])),created:function(){},watch:{keyword:function(e,t){}},methods:{submit:function(){var e=this;this.$confirm("确认发送好友请求？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t={friendUserId:e.friendUserId,applyReason:e.applyReason.trim()||e.placeholder,remark:e.remark,applyFrom:e.applyFrom,fromRemark:e.fromRemark};e.$store.dispatch("applyFriend",t).then(function(t){console.log(t),e.$message({type:"success",message:"发送成功!"}),e.$router.replace({name:"UserInfo",params:{userId:e.friendUserId},query:{applyFrom:e.applyFrom,fromRemark:e.fromRemark}})}).catch(function(e){console.log(e)})}).catch(function(){})},back:function(){history.back()}}},Oe={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-header",[n("el-button",{staticClass:"btn-left",attrs:{icon:"el-icon-arrow-left"},on:{click:function(t){e.back()}}}),e._v(" "),n("h3",[e._v("添加好友")])],1),e._v(" "),n("el-main",[n("div",{staticClass:"search-form"},[n("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[n("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.select,callback:function(t){e.select=t},expression:"select"}},[n("el-option",{attrs:{label:"学号",value:"studentid"}}),e._v(" "),n("el-option",{attrs:{label:"手机号",value:"mobile"}})],1),e._v(" "),n("el-button",{attrs:{slot:"append",icon:"el-icon-search"},slot:"append"})],1)],1)])],1)},staticRenderFns:[]};var xe=n("U5Ua")(Ne,Oe,!1,function(e){n("+oBa")},"data-v-503bb8d8",null).exports;s.default.use(se.a);var Fe=new se.a({routes:[{path:"/chat/:conversationType/:targetId",name:"Chat",component:Re,props:function(e){return{conversationType:parseInt(e.params.conversationType),targetId:e.params.targetId+""}}},{path:"/user-info/:userId",name:"UserInfo",component:ce,props:function(e){return{userId:e.params.userId,applyFrom:e.query.applyFrom,fromRemark:e.query.fromRemark}}},{path:"/apply-friend/:friendUserId",name:"ApplyFriend",component:Ue,props:function(e){return{friendUserId:e.params.friendUserId,applyFrom:e.query.applyFrom,fromRemark:e.query.fromRemark}}},{path:"/search-friend",name:"SearchFriend",component:xe},{path:"/group-info/:groupId",name:"GroupInfo",component:de,props:!0},{path:"/group-bulletin/:groupId",name:"Bulletin",component:Ee,props:!0},{path:"/",name:"Index",component:re}]}),Ge=(n("i6vy"),n("1tn5"),n("fHGE"));function De(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null}s.default.component("icon",Ge.a),s.default.use(S.a),s.default.config.productionTip=!1,s.default.prototype.globalClick=function(e){document.addEventListener("click",function(t){e(t)})},RongIMLib.RongIMEmoji.init(),RongIMLib.RongIMVoice.init(),Fe.beforeEach(function(e,t,n){var s=De("token"),o=De("userId");s&&o&&(X.commit("SET_TOKEN",s),X.commit("SET_USER_ID",o),history.replaceState({},"new-url",location.origin+location.hash)),X.getters.token&&X.getters.userId||S.a.Message({message:"请先登录再访问",type:"error",duration:5e3}),n()}),new s.default({el:"#app",router:Fe,store:X,components:{App:ne},template:"<App/>"})},"Pl+j":function(e,t){},QyKp:function(e,t){},ZA1C:function(e,t){},eQon:function(e,t){},fHGE:function(e,t,n){"use strict";var s={},o={name:"icon",props:{name:{type:String,validator:function(e){return e?e in s||(console.warn('Invalid prop: prop "name" is referring to an unregistered icon "'+e+'".\nPlease make sure you have imported this icon before using it.'),!1):(console.warn('Invalid prop: prop "name" is required.'),!1)}},scale:[Number,String],spin:Boolean,inverse:Boolean,pulse:Boolean,flip:{validator:function(e){return"horizontal"===e||"vertical"===e}},label:String},data:function(){return{x:!1,y:!1,childrenWidth:0,childrenHeight:0,outerScale:1}},computed:{normalizedScale:function(){var e=this.scale;return e=void 0===e?1:Number(e),isNaN(e)||e<=0?(console.warn('Invalid prop: prop "scale" should be a number over 0.',this),this.outerScale):e*this.outerScale},klass:function(){return{"fa-icon":!0,"fa-spin":this.spin,"fa-flip-horizontal":"horizontal"===this.flip,"fa-flip-vertical":"vertical"===this.flip,"fa-inverse":this.inverse,"fa-pulse":this.pulse}},icon:function(){return this.name?s[this.name]:null},box:function(){return this.icon?"0 0 "+this.icon.width+" "+this.icon.height:"0 0 "+this.width+" "+this.height},ratio:function(){if(!this.icon)return 1;var e=this.icon,t=e.width,n=e.height;return Math.max(t,n)/16},width:function(){return this.childrenWidth||this.icon&&this.icon.width/this.ratio*this.normalizedScale||0},height:function(){return this.childrenHeight||this.icon&&this.icon.height/this.ratio*this.normalizedScale||0},style:function(){return 1!==this.normalizedScale&&{fontSize:this.normalizedScale+"em"}},raw:function(){if(!this.icon||!this.icon.raw)return null;var e=this.icon.raw,t={};return e=e.replace(/\s(?:xml:)?id=(["']?)([^"')\s]+)\1/g,function(e,n,s){var o="fa-"+(r++).toString(16);return t[s]=o,' id="'+o+'"'}),e=e.replace(/#(?:([^'")\s]+)|xpointer\(id\((['"]?)([^')]+)\2\)\))/g,function(e,n,s,o){var r=n||o;return r&&t[r]?"#"+t[r]:e}),e}},mounted:function(){var e=this;if(!this.icon){this.$children.forEach(function(t){t.outerScale=e.normalizedScale});var t=0,n=0;this.$children.forEach(function(e){t=Math.max(t,e.width),n=Math.max(n,e.height)}),this.childrenWidth=t,this.childrenHeight=n,this.$children.forEach(function(e){e.x=(t-e.width)/2,e.y=(n-e.height)/2})}},register:function(e){for(var t in e){var n=e[t];n.paths||(n.paths=[]),n.d&&n.paths.push({d:n.d}),n.polygons||(n.polygons=[]),n.points&&n.polygons.push({points:n.points}),s[t]=n}},icons:s},r=870711;var a={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("svg",{class:e.klass,style:e.style,attrs:{version:"1.1",role:e.label?"img":"presentation","aria-label":e.label,x:e.x,y:e.y,width:e.width,height:e.height,viewBox:e.box}},[e._t("default",[e.icon&&e.icon.paths?e._l(e.icon.paths,function(t,s){return n("path",e._b({key:"path-"+s},"path",t,!1))}):e._e(),e._v(" "),e.icon&&e.icon.polygons?e._l(e.icon.polygons,function(t,s){return n("polygon",e._b({key:"polygon-"+s},"polygon",t,!1))}):e._e(),e._v(" "),e.icon&&e.icon.raw?[n("g",{domProps:{innerHTML:e._s(e.raw)}})]:e._e()])],2)},staticRenderFns:[]};var i=n("U5Ua")(o,a,!1,function(e){n("JhE6")},null,null);t.a=i.exports},g3V2:function(e,t){},i6vy:function(e,t){},kBom:function(e,t){},mzmZ:function(e,t){},pgi2:function(e,t){},"q+OS":function(e,t){},xK5B:function(e,t,n){var s={"./af":"8ChU","./af.js":"8ChU","./ar":"74IR","./ar-dz":"PPxu","./ar-dz.js":"PPxu","./ar-kw":"j2OE","./ar-kw.js":"j2OE","./ar-ly":"4Jvs","./ar-ly.js":"4Jvs","./ar-ma":"fw9T","./ar-ma.js":"fw9T","./ar-sa":"9n2O","./ar-sa.js":"9n2O","./ar-tn":"gFRf","./ar-tn.js":"gFRf","./ar.js":"74IR","./az":"K/7t","./az.js":"K/7t","./be":"c/jt","./be.js":"c/jt","./bg":"Wmbp","./bg.js":"Wmbp","./bm":"I+NC","./bm.js":"I+NC","./bn":"xhTx","./bn.js":"xhTx","./bo":"rvnu","./bo.js":"rvnu","./br":"MUDG","./br.js":"MUDG","./bs":"rz6q","./bs.js":"rz6q","./ca":"VGKJ","./ca.js":"VGKJ","./cs":"Dzuy","./cs.js":"Dzuy","./cv":"e4rC","./cv.js":"e4rC","./cy":"6xfb","./cy.js":"6xfb","./da":"6vRO","./da.js":"6vRO","./de":"W0af","./de-at":"gi1s","./de-at.js":"gi1s","./de-ch":"I1ug","./de-ch.js":"I1ug","./de.js":"W0af","./dv":"iOYW","./dv.js":"iOYW","./el":"FZQs","./el.js":"FZQs","./en-au":"nBg3","./en-au.js":"nBg3","./en-ca":"ZNQz","./en-ca.js":"ZNQz","./en-gb":"a/mY","./en-gb.js":"a/mY","./en-ie":"GeU8","./en-ie.js":"GeU8","./en-il":"ZH3E","./en-il.js":"ZH3E","./en-nz":"Lq60","./en-nz.js":"Lq60","./eo":"sOIF","./eo.js":"sOIF","./es":"nR68","./es-do":"DDBr","./es-do.js":"DDBr","./es-us":"KpH6","./es-us.js":"KpH6","./es.js":"nR68","./et":"cUIQ","./et.js":"cUIQ","./eu":"wsTJ","./eu.js":"wsTJ","./fa":"AsfP","./fa.js":"AsfP","./fi":"Q49j","./fi.js":"Q49j","./fo":"F7eL","./fo.js":"F7eL","./fr":"pazI","./fr-ca":"Rzma","./fr-ca.js":"Rzma","./fr-ch":"ehkF","./fr-ch.js":"ehkF","./fr.js":"pazI","./fy":"0JuU","./fy.js":"0JuU","./gd":"TAB0","./gd.js":"TAB0","./gl":"+RrA","./gl.js":"+RrA","./gom-latn":"uyeR","./gom-latn.js":"uyeR","./gu":"qZY8","./gu.js":"qZY8","./he":"SY0Z","./he.js":"SY0Z","./hi":"aZin","./hi.js":"aZin","./hr":"cICN","./hr.js":"cICN","./hu":"xQIK","./hu.js":"xQIK","./hy-am":"T9PO","./hy-am.js":"T9PO","./id":"CUJT","./id.js":"CUJT","./is":"mluG","./is.js":"mluG","./it":"VvK9","./it.js":"VvK9","./ja":"RgRY","./ja.js":"RgRY","./jv":"SG7w","./jv.js":"SG7w","./ka":"QiV0","./ka.js":"QiV0","./kk":"BfME","./kk.js":"BfME","./km":"E72r","./km.js":"E72r","./kn":"4ZbA","./kn.js":"4ZbA","./ko":"M3qT","./ko.js":"M3qT","./ky":"pfYi","./ky.js":"pfYi","./lb":"qRbK","./lb.js":"qRbK","./lo":"ZmdW","./lo.js":"ZmdW","./lt":"DqQk","./lt.js":"DqQk","./lv":"vTQC","./lv.js":"vTQC","./me":"ksov","./me.js":"ksov","./mi":"CesW","./mi.js":"CesW","./mk":"/cw7","./mk.js":"/cw7","./ml":"/RMX","./ml.js":"/RMX","./mr":"zPWJ","./mr.js":"zPWJ","./ms":"OwmU","./ms-my":"2kYQ","./ms-my.js":"2kYQ","./ms.js":"OwmU","./mt":"tsZy","./mt.js":"tsZy","./my":"7JAz","./my.js":"7JAz","./nb":"jphT","./nb.js":"jphT","./ne":"zgdn","./ne.js":"zgdn","./nl":"H9XR","./nl-be":"5dUa","./nl-be.js":"5dUa","./nl.js":"H9XR","./nn":"SVeR","./nn.js":"SVeR","./pa-in":"yz10","./pa-in.js":"yz10","./pl":"sbG1","./pl.js":"sbG1","./pt":"axlB","./pt-br":"CMPN","./pt-br.js":"CMPN","./pt.js":"axlB","./ro":"X3hD","./ro.js":"X3hD","./ru":"n0Ql","./ru.js":"n0Ql","./sd":"uw1b","./sd.js":"uw1b","./se":"FuMz","./se.js":"FuMz","./si":"mAp8","./si.js":"mAp8","./sk":"OZAM","./sk.js":"OZAM","./sl":"EKC+","./sl.js":"EKC+","./sq":"7fQj","./sq.js":"7fQj","./sr":"q1YU","./sr-cyrl":"3m+4","./sr-cyrl.js":"3m+4","./sr.js":"q1YU","./ss":"1plO","./ss.js":"1plO","./sv":"oqG9","./sv.js":"oqG9","./sw":"k/Es","./sw.js":"k/Es","./ta":"Rxzv","./ta.js":"Rxzv","./te":"wJsc","./te.js":"wJsc","./tet":"RFBe","./tet.js":"RFBe","./tg":"2YQM","./tg.js":"2YQM","./th":"Y4yZ","./th.js":"Y4yZ","./tl-ph":"mNJb","./tl-ph.js":"mNJb","./tlh":"9b6X","./tlh.js":"9b6X","./tr":"8f0c","./tr.js":"8f0c","./tzl":"shOQ","./tzl.js":"shOQ","./tzm":"p2/r","./tzm-latn":"Ryxg","./tzm-latn.js":"Ryxg","./tzm.js":"p2/r","./ug-cn":"SwGz","./ug-cn.js":"SwGz","./uk":"enih","./uk.js":"enih","./ur":"nVFX","./ur.js":"nVFX","./uz":"WQIF","./uz-latn":"PStV","./uz-latn.js":"PStV","./uz.js":"WQIF","./vi":"qW2m","./vi.js":"qW2m","./x-pseudo":"aMIS","./x-pseudo.js":"aMIS","./yo":"mqwd","./yo.js":"mqwd","./zh-cn":"6Kjw","./zh-cn.js":"6Kjw","./zh-hk":"NuhA","./zh-hk.js":"NuhA","./zh-tw":"Wgm3","./zh-tw.js":"Wgm3"};function o(e){return n(r(e))}function r(e){var t=s[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}o.keys=function(){return Object.keys(s)},o.resolve=r,e.exports=o,o.id="xK5B"}},["NHnr"]);
//# sourceMappingURL=app.aefcfd11d788f538003b.js.map